# 实施计划文档：Text2Poster Generator

本文档根据 `design.md` 的规划，将项目分解为具体、可执行的步骤。

## 🗓️ 阶段一：环境准备与模板搭建 ✅ 已完成

此阶段的目标是搭建项目基础，包括创建必要的文件和目录，并完成静态网页模板的设计。

- [x] **1. 初始化项目结构**:
    - [x] 创建 Git 仓库 (`.git` 已存在)
    - [x] 创建 `output` 文件夹，用于存放生成的图片。
    - [x] 创建 `input.txt` 文件，并填入示例文本。
    - [x] 创建 `main.py`，作为核心逻辑脚本文件。

- [x] **2. 安装依赖**:
    - [x] 在 `requirements.txt` 中添加 `playwright`。
    - [x] 执行 `pip install -r requirements.txt` 安装依赖。
    - [x] 执行 `playwright install` 下载浏览器驱动。

- [x] **3. HTML 模板设计 (`index.html`)**:
    - [x] 创建 `index.html` 文件。
    - [x] 基于 `Reference-style` 中的图片，设计 HTML 结构。关键元素包括一个用于包裹海报的容器 `div` (例如, `id="poster"`) 和一个用于动态填充文本的 `p` 或 `div` (例如, `id="text-container"`)。

- [x] **4. CSS 样式开发 (`style.css`)**:
    - [x] 创建 `style.css` 文件。
    - [x] 编写 CSS 规则，实现以下视觉效果：
        - **背景**: 设置与参考图片相似的渐变或纯色背景。
        - **布局**: 使用 Flexbox 或 Grid 实现文字的垂直和水平居中。
        - **字体**: 引入开源字体（Noto Sans SC），并设置字体大小、颜色和行间距。
        - **尺寸**: 为海报容器 `#poster` 设置固定的宽高（例如 `1080x1440` 像素）。
    - [x] 在 `index.html` 中链接 `style.css`。

## 🚀 阶段二：核心脚本开发 ✅ 已完成

此阶段专注于 `main.py` 的编写，并实现了动态内容分页功能。

- [x] **1. 读取输入文件**:
    - [x] 读取 `input.txt`，将每行文字存入列表。

- [x] **2. 升级 HTML/CSS 模板**:
    - [x] 在 `style.css` 中，定义两种不同的样式：
        - **封面页样式** (`.poster-cover`): 用于系列图片的第一张，设计更醒目。
        - **内页样式** (`.poster-content`): 用于后续页面，版式更简洁，专注于内容呈现。
    - [x] 在 `index.html` 中，为海报容器添加默认的 class。

- [x] **3. 编写内容分页的 JavaScript 逻辑**:
    - [x] 在 `main.py` 中以字符串形式管理 JavaScript 代码。
    - [x] 编写 JS 函数，实现以下功能：
        - 接收完整的文本内容。
        - 将文本逐字或逐词添加到海报的文本容器中。
        - 持续检测文本容器的 `scrollHeight` 是否超过其 `clientHeight`。
        - 当内容溢出时，记录下溢出点的前一个字符位置，并将该点前的所有内容作为"一页"。
        - 重复此过程，直到所有文本都被分割成"页"的数组。
        - 返回这个包含多页文本内容的数组。

- [x] **4. 改造 Playwright 核心逻辑 (`main.py`)**:
    - [x] 导入 `playwright` 并初始化浏览器。
    - [x] 遍历从 `input.txt` 读取的文本列表。
    - [x] **对于每一篇文章**:
        - [x] 打开 `index.html` 页面。
        - [x] 使用 `page.evaluate()` 执行 JS 分页函数，将当前文章的完整文本传入，并获取返回的文本页数组。
        - [x] **生成封面页**:
            - [x] 使用 `page.locator().fill()` 将数组的第一页文本填入。
            - [x] 确保海报容器拥有 `.poster-cover` 样式。
            - [x] 截图并保存为 `article_01_cover.png`。
        - [x] **生成内页 (如果有多页)**:
            - [x] 遍历文本数组的剩余部分。
            - [x] 对于每一页文本：
                - [x] 使用 JS 修改海报容器的 class 为 `.poster-content`。
                - [x] 将当前页的文本填入。
                - [x] 截图并保存为 `article_01_content_01.png`, `article_01_content_02.png`...

- [x] **5. 完善与收尾**:
    - [x] 确保浏览器正确关闭。
    - [x] 更新 print 语句，以反映新的多页生成流程。

## 🧪 阶段三：测试、优化与文档编写 ✅ 已完成

此阶段的目标是验证更复杂的输出、进行微调，并完成所有必要的项目文档。

- [x] **1. 测试与验证**:
    - [x] 准备包含不同长度文本的 `input.txt`（短文本、刚好一页的文本、超长文本）。
    - [x] 运行 `main.py`，检查以下情况：
        - [x] 短文本是否只生成一张封面图。
        - [x] 长文本是否按预期生成了"1张封面 + N张内页"。
        - [x] 封面页和内页的样式是否正确应用。
        - [x] 文件命名是否规范。

- [x] **2. 迭代优化**:
    - [x] **JS 分页逻辑优化**: 微调 JS 代码，确保文本分割点是句子结尾或单词之间，避免将单词从中间断开。
    - [x] **CSS 样式微调**: 根据测试结果，调整 `style.css` 中的两种样式，达到最佳视觉效果。

- [x] **3. 编写文档**:
    - [x] 创建并完成 `manual.md`，清晰地说明如何安装依赖、准备 `input.txt` 以及如何运行 `main.py` 脚本。
    - [x] 创建 `dev_log.md`，记录开发过程中的关键步骤和决策。
    - [x] 创建 `experience.md`，总结本次使用 Gemini CLI + Playwright MCP 的开发经验和思考。

- [x] **4. 版本控制**:
    - [x] 使用 `git add .` 将所有项目文件添加到暂存区。
    - [x] 编写清晰的 Commit Message，并提交代码。

## 🎨 阶段四：功能增强与优化 ✅ 已完成

此阶段专注于增强项目功能，提升用户体验和视觉效果。

- [x] **1. 关键词高亮功能**:
    - [x] 创建 `kimi_highlighter.py` 模块，集成 Kimi API。
    - [x] 实现关键词提取和 HTML 高亮功能。
    - [x] 在 `main.py` 中集成关键词高亮功能。

- [x] **2. 视觉样式优化**:
    - [x] 优化标题和正文的字体样式。
    - [x] 调整标题和正文间距。
    - [x] 优化标题字体间距（letter-spacing 和 line-height）。
    - [x] 自定义封面背景渐变效果。

- [x] **3. 标题视觉效果**:
    - [x] 添加文字阴影效果（text-shadow）。
    - [x] 添加文字描边效果（-webkit-text-stroke）。
    - [x] 优化字体粗细和视觉效果。

- [x] **4. Emoji 支持**:
    - [x] 实现跨平台 Emoji 渲染支持。
    - [x] 创建手动添加 Emoji 的指南。
    - [x] 实现 AI 智能添加 Emoji 功能。
    - [x] 解决 Windows 控制台 Unicode 编码问题。

- [x] **5. 文档整理**:
    - [x] 创建 `docs` 文件夹，统一管理所有文档。
    - [x] 整理和更新所有 Markdown 文档。
    - [x] 创建项目导航和索引。

## 🚀 阶段五：未来扩展计划

此阶段规划项目的未来发展方向和潜在功能。

- [ ] **1. 多套配色主题**:
    - [ ] 实现 CSS 变量系统。
    - [ ] 创建多套预设主题。
    - [ ] 添加主题切换功能。

- [ ] **2. 配置系统**:
    - [ ] 创建配置文件系统。
    - [ ] 支持用户自定义设置。
    - [ ] 添加配置验证功能。

- [ ] **3. 批量处理优化**:
    - [ ] 优化多文件处理性能。
    - [ ] 添加进度条显示。
    - [ ] 支持并行处理。

- [ ] **4. Web UI 开发**:
    - [ ] 开发 Web 界面。
    - [ ] 实现拖拽上传功能。
    - [ ] 添加实时预览功能。

## 📊 项目完成状态总结

### ✅ 已完成功能
- 基础项目架构搭建
- 动态内容分页系统
- 关键词高亮功能
- 视觉样式优化
- 标题视觉效果
- Emoji 支持（手动 + AI 智能）
- 完整文档系统
- 版本控制管理

### 🔄 进行中功能
- 无

### 📋 待开发功能
- 多套配色主题
- 配置系统
- 批量处理优化
- Web UI 开发

### 📈 项目统计
- **总开发时间**: 约 8-10 小时
- **代码文件**: 4 个核心文件
- **文档文件**: 8 个 Markdown 文档
- **功能模块**: 6 个主要功能
- **测试用例**: 多种文本长度测试